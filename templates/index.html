<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate My Day</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen p-0 md:p-0">
    <nav class="border-gray-200 bg-white shadow">
        <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4">
            <a href="/" class="flex items-center space-x-3 rtl:space-x-reverse">
                <span class="self-center text-2xl whitespace-nowrap">Rate<span
                        class="font-bold">MyDay</span></span>
            </a>

            <nav class="flex" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
                    <li class="inline-flex items-center">
                        <a href="#home" id="homeLink"
                            class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
                            Home
                        </a>
                    </li>
                    <li>
                        <div class="flex items-center">
                            <a href="#graph" id="graphLink"
                                class="ms-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ms-2">Histori
                                Graph</a>
                        </div>
                    </li>
                </ol>
            </nav>

        </div>
    </nav>

    <!--Konten utama-->
    <div class="flex items-center justify-center py-8">
        <div
            class="bg-white shadow-lg rounded p-6 w-full max-w-4xl backdrop-blur-sm bg-opacity-90 transition-all duration-300 hover:shadow-2xl">
            <!--Grafik rating-->
            <div class="space-y-6">
                <div class="space-y-2">
                    <h1 class="text-xl font-semibold text-gray-800 text-center">Track Your Day with Charts! </h1>
                    <p class="text-gray-500 text-sm text-center">View your daily ratings in bar and line charts.</p>
                </div>

                <div class="relative w-full h-[400px]">
                    <canvas id="ratingChart"></canvas>
                </div>
            </div>

            <!--Form rating-->
            <div class="space-y-6 pt-14">
                <div class="text-center space-y-2">
                    <h1 class="text-xl font-semibold text-gray-800">How's Your Day?</h1>
                    <p class="text-gray-500 text-sm">Take a moment to reflect on your day</p>
                </div>

                <form id="ratingForm" class="space-y-6">
                    <div class="space-y-2">
                        <div class="mb-1">
                            <label class="block text-sm font-bold text-gray-700">Date</label>
                            <label class="block text-sm text-gray-700 mt-2">Pick a date, or I'll default to today!</label>
                        </div>
                        <input type="date" name="date" id="date"
                            class="w-full p-3 border border-gray-200 rounded bg-gray-50 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-300"
                            required>
                    </div>

                    <div class="space-y-2">
                        <div class="mb-1">
                            <label class="block text-sm font-bold text-gray-700">Rating</label>
                            <label class="block text-sm text-gray-700 mt-2">Rate how you're feeling today!</label>
                        </div>
                        <select name="rating"
                            class="w-full p-3 border border-gray-200 rounded bg-gray-50 focus:bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50 transition-all duration-300"
                            required>
                            <option value="">Pick a rating</option>
                            <option value="1">üòû Terrible</option>
                            <option value="2">‚òπÔ∏è Not Good</option>
                            <option value="3">üòê Okay</option>
                            <option value="4">üôÇ Good</option>
                            <option value="5">üòä Excellent</option>
                        </select>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-indigo-500 text-white py-3 px-6 rounded-xl font-medium
                           hover:from-blue-600 hover:to-indigo-600 transition-all duration-300 hover:shadow-lg
                           focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-50">
                        Submit Rating
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!--Form rating-->
    <script>
        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();

        // Handle form submission
        document.getElementById('ratingForm').addEventListener('submit', function (event) {
            event.preventDefault();

            // Show loading state
            const button = this.querySelector('button');
            const originalText = button.innerHTML;
            button.innerHTML = 'Submitting...';
            button.disabled = true;

            fetch("/", {
                method: "POST",
                body: new FormData(this)
            })
                .then(response => response.json())
                .then(data => {
                    Swal.fire({
                        title: "Thank you!",
                        text: "Your rating has been submitted successfully",
                        icon: "success",
                        confirmButtonText: "Continue",
                        confirmButtonColor: '#4F46E5',
                        background: '#fff'
                    }).then(() => {
                        location.reload();
                    });
                })
                .catch(error => {
                    Swal.fire({
                        title: "Oops!",
                        text: "Something went wrong. Please try again.",
                        icon: "error",
                        confirmButtonColor: '#4F46E5',
                        confirmButtonText: "Okay"
                    });
                })
                .finally(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                });
        });
    </script>

    <!--Grafik rating-->
    <script>
        var data = JSON.parse('{{ chart_data | tojson | safe }}');
        data.ratings = data.ratings.map(Number);

        // Konversi rating angka ke label teks
        var ratingLabels = {
            1: "üòû",
            2: "‚òπÔ∏è",
            3: "üòê",
            4: "üôÇ",
            5: "üòä"
        };

        var ctx = document.getElementById("ratingChart").getContext("2d");

        window.ratingChart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: data.dates,
                datasets: [
                    {
                        label: "Rating Harian",
                        data: data.ratings,
                        backgroundColor: "rgba(99, 102, 241, 0.5)", // Indigo color
                        borderColor: "rgb(99, 102, 241)",
                        borderWidth: 1,
                        borderRadius: 4,
                        type: "bar"
                    },
                    {
                        label: "Tren Rating",
                        data: data.ratings,
                        borderColor: "rgb(244, 63, 94)", // Rose color
                        backgroundColor: "rgba(244, 63, 94, 0.1)",
                        borderWidth: 2,
                        fill: true,
                        type: "line",
                        tension: 0.4,
                        pointBackgroundColor: "rgb(244, 63, 94)",
                        pointBorderColor: "#fff",
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: "top",
                        labels: {
                            padding: 20,
                            font: {
                                family: "Inter, sans-serif",
                                weight: 500,
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        bodyFont: {
                            size: 16
                        },
                        callbacks: {
                            label: function (tooltipItem) {
                                let ratingValue = tooltipItem.raw;
                                return ratingLabels[ratingValue] || ratingValue;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        min: 1,  // Menambah jarak di bawah
                        max: 5,  // Menambah jarak di atas
                        ticks: {
                            stepSize: 1,
                            callback: function (value) {
                                // Membulatkan nilai untuk mencocokkan dengan indeks ratingLabels
                                const roundedValue = Math.round(value);
                                // Return emoji jika nilai ada dalam ratingLabels
                                return ratingLabels[roundedValue] || '';
                            },
                            font: {
                                family: "Inter, sans-serif",
                                size: 30
                            }
                        },
                        grid: {
                            color: "rgba(0, 0, 0, 0.05)"
                        }
                    },
                    x: {
                        ticks: {
                            font: {
                                family: "Inter, sans-serif",
                                size: 14
                            }
                        },
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    </script>
</body>

</html>